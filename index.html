<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o Familiar - Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 450px; text-align: center; }
        .hidden { display: none; }
        .user-info { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; justify-content: center; font-weight: bold; }
        .user-info img { width: 40px; border-radius: 50%; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        #btnLogin { background: white; border: 2px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #btnSalvar { background: #1a73e8; color: white; }
        .tarefa-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .concluida { text-decoration: line-through; color: gray; }
    </style>
</head>
<body>

    <div class="container">
        <div id="telaLogin">
            <h1>üè† Gest√£o Familiar</h1>
            <p>Entre para organizar sua casa</p>
            <button id="btnLogin">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                Entrar com Google
            </button>
        </div>

        <div id="telaApp" class="hidden">
            <div class="user-info">
                <img id="userPhoto" src="">
                <span id="userName"></span>
                <button id="btnLogout" style="width: auto; padding: 5px 10px; background: #eee;">Sair</button>
            </div>
            
            <input type="text" id="inputTarefa" placeholder="Nova tarefa...">
            <button id="btnSalvar">Adicionar</button>

            <ul id="listaTarefas" style="list-style: none; padding: 0;"></ul>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBG9XmFduYzpXhYcWF9UPSbGa-w2GZ3cKc",
            authDomain: "gestao-familiar-ac7d6.firebaseapp.com",
            projectId: "gestao-familiar-ac7d6",
            storageBucket: "gestao-familiar-ac7d6.firebasestorage.app",
            messagingSenderId: "1063581141078",
            appId: "1:1063581141078:web:af2fc67412dbc6fee313f7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // ELEMENTOS
        const telaLogin = document.getElementById('telaLogin');
        const telaApp = document.getElementById('telaApp');
        const btnLogin = document.getElementById('btnLogin');
        const btnLogout = document.getElementById('btnLogout');

        // LOGIN E LOGOUT
        btnLogin.onclick = () => signInWithPopup(auth, provider);
        btnLogout.onclick = () => signOut(auth);

        // OBSERVADOR DE USU√ÅRIO (M√°gica do Login)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                telaLogin.classList.add('hidden');
                telaApp.classList.remove('hidden');
                document.getElementById('userName').innerText = user.displayName;
                document.getElementById('userPhoto').src = user.photoURL;
                carregarTarefas();
            } else {
                telaLogin.classList.remove('hidden');
                telaApp.classList.add('hidden');
            }
        });

        function carregarTarefas() {
            const q = query(collection(db, "tarefas"), orderBy("dataCriacao", "desc"));
            onSnapshot(q, (snapshot) => {
                const lista = document.getElementById('listaTarefas');
                lista.innerHTML = "";
                snapshot.forEach(docSnap => {
                    const t = docSnap.data();
                    const li = document.createElement('li');
                    li.className = 'tarefa-item';
                    li.innerHTML = `
                        <span class="${t.concluida ? 'concluida' : ''}">${t.descricao} <br> <small>por: ${t.autor}</small></span>
                        <button onclick="window.excluirTarefa('${docSnap.id}')" style="width:auto; background:none; color:red;">X</button>
                    `;
                    lista.appendChild(li);
                });
            });
        }

        document.getElementById('btnSalvar').onclick = async () => {
            const input = document.getElementById('inputTarefa');
            if (input.value) {
                await addDoc(collection(db, "tarefas"), {
                    descricao: input.value,
                    autor: auth.currentUser.displayName,
                    concluida: false,
                    dataCriacao: new Date()
                });
                input.value = "";
            }
        };

        window.excluirTarefa = async (id) => {
            await deleteDoc(doc(db, "tarefas", id));
        };
    </script>
</body>
</html>

